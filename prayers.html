<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prayer Requests ‚Äî Lehem Network International</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;600;700&family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #C9922A; --gold-light: #F0C060; --gold-pale: #FAE8B0;
    --deep: #0A0604; --dark: #110C05; --mid: #1E1508; --warm: #2A1F0E;
    --text: #EDE0C8; --muted: #9A8870; --teal: #30C0A0;
    --success: #30C090; --error: #E63030;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { scroll-behavior: smooth; }
  body { background: var(--deep); color: var(--text); font-family: 'Lato', sans-serif; font-weight: 300; overflow-x: hidden; }
  body::before {
    content: ''; position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 9999; opacity: 0.4;
  }

  nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding: 18px 48px; background: rgba(10,6,4,0.97); border-bottom: 1px solid rgba(201,146,42,0.15); backdrop-filter: blur(8px); }
  .nav-logo { display: flex; align-items: center; gap: 12px; text-decoration: none; }
  .nav-emblem { width: 38px; height: 38px; }
  .nav-wordmark { font-family: 'Cinzel', serif; font-size: 1rem; font-weight: 700; color: var(--gold-light); letter-spacing: 0.15em; line-height: 1.1; }
  .nav-wordmark span { display: block; font-size: 0.58rem; font-weight: 400; color: var(--muted); letter-spacing: 0.3em; text-transform: uppercase; }
  .nav-back { font-family: 'Cinzel', serif; font-size: 0.72rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); text-decoration: none; transition: color 0.3s; }
  .nav-back:hover { color: var(--gold-light); }

  .page-hero { min-height: 44vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 140px 40px 80px; position: relative; overflow: hidden; }
  .page-hero-bg { position: absolute; inset: 0; background: radial-gradient(ellipse 70% 60% at 50% 50%, rgba(201,146,42,0.09) 0%, transparent 70%); }
  .page-label { font-family: 'Cinzel', serif; font-size: 0.65rem; letter-spacing: 0.5em; text-transform: uppercase; color: var(--gold); margin-bottom: 16px; animation: fadeUp 0.8s ease both; }
  .page-title { font-family: 'Cinzel Decorative', serif; font-size: clamp(2rem, 5vw, 4rem); font-weight: 900; color: var(--gold-light); text-shadow: 0 0 60px rgba(201,146,42,0.25); margin-bottom: 16px; animation: fadeUp 0.8s 0.1s ease both; }
  .page-subtitle { font-size: 1rem; color: var(--muted); line-height: 1.8; max-width: 560px; animation: fadeUp 0.8s 0.2s ease both; }
  .divider { width: 60px; height: 2px; background: linear-gradient(to right, var(--gold), transparent); margin: 20px auto; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }

  /* LAYOUT */
  .prayer-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 2px; max-width: 1300px; margin: 0 auto; padding: 0 48px 120px; align-items: start; }

  /* SUBMIT FORM */
  .prayer-form-wrap { background: var(--dark); border: 1px solid rgba(201,146,42,0.2); padding: 56px 48px; position: sticky; top: 100px; }
  .form-section-title { font-family: 'Cinzel', serif; font-size: 1.2rem; color: var(--gold-light); margin-bottom: 8px; }
  .form-section-sub { font-size: 0.85rem; color: var(--muted); margin-bottom: 36px; line-height: 1.7; }
  .form-group { margin-bottom: 20px; }
  .form-group label { display: block; font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; }
  .form-group input, .form-group select, .form-group textarea { width: 100%; background: var(--mid); border: 1px solid rgba(201,146,42,0.2); color: var(--text); font-family: 'Lato', sans-serif; font-size: 0.9rem; padding: 14px 16px; outline: none; transition: border-color 0.3s; resize: vertical; }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: var(--gold); }
  .form-group select { appearance: none; }

  .visibility-toggle { display: flex; gap: 0; margin-bottom: 24px; }
  .vis-btn { flex: 1; background: var(--mid); border: 1px solid rgba(201,146,42,0.2); color: var(--muted); font-family: 'Cinzel', serif; font-size: 0.68rem; letter-spacing: 0.15em; text-transform: uppercase; padding: 12px; cursor: pointer; transition: all 0.2s; }
  .vis-btn.active { background: rgba(201,146,42,0.15); border-color: var(--gold); color: var(--gold-light); }
  .vis-note { font-size: 0.78rem; color: var(--muted); margin-top: 8px; line-height: 1.5; }

  .btn-submit { width: 100%; background: linear-gradient(135deg, var(--gold-light), var(--gold)); color: var(--deep); font-family: 'Cinzel', serif; font-size: 0.82rem; font-weight: 700; letter-spacing: 0.2em; text-transform: uppercase; padding: 18px; border: none; cursor: pointer; transition: all 0.3s; margin-top: 8px; }
  .btn-submit:hover { box-shadow: 0 8px 32px rgba(201,146,42,0.4); transform: translateY(-2px); }
  .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

  /* PRAYER FEED */
  .prayer-feed-wrap { padding-left: 48px; }
  .feed-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
  .feed-title { font-family: 'Cinzel', serif; font-size: 1rem; color: var(--gold-pale); letter-spacing: 0.2em; text-transform: uppercase; }
  .feed-count-badge { background: var(--mid); border: 1px solid rgba(201,146,42,0.2); font-size: 0.7rem; color: var(--muted); padding: 4px 12px; border-radius: 100px; }

  .prayer-card { background: var(--mid); border-left: 3px solid rgba(201,146,42,0.3); padding: 24px 28px; margin-bottom: 2px; transition: all 0.3s; animation: slideIn 0.5s ease both; }
  .prayer-card:hover { background: var(--warm); border-left-color: var(--gold); }
  @keyframes slideIn { from { opacity: 0; transform: translateX(16px); } to { opacity: 1; transform: translateX(0); } }

  .prayer-card-meta { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
  .prayer-card-name { font-family: 'Cinzel', serif; font-size: 0.7rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--gold); }
  .prayer-card-dot { width: 3px; height: 3px; background: var(--muted); border-radius: 50%; }
  .prayer-card-location { font-size: 0.72rem; color: var(--muted); }
  .prayer-card-time { font-size: 0.7rem; color: var(--muted); margin-left: auto; }
  .prayer-card-text { font-size: 0.88rem; color: var(--text); line-height: 1.7; margin-bottom: 12px; }
  .prayer-card-category { font-size: 0.65rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); }

  .agree-btn { background: none; border: 1px solid rgba(201,146,42,0.2); color: var(--muted); font-family: 'Cinzel', serif; font-size: 0.62rem; letter-spacing: 0.15em; text-transform: uppercase; padding: 6px 14px; cursor: pointer; transition: all 0.2s; margin-top: 12px; }
  .agree-btn:hover { border-color: var(--gold); color: var(--gold-light); background: rgba(201,146,42,0.08); }
  .agree-btn.agreed { border-color: var(--teal); color: var(--teal); }

  .empty-feed { text-align: center; padding: 60px 20px; color: var(--muted); font-size: 0.88rem; }
  .empty-feed-icon { font-size: 2.5rem; margin-bottom: 16px; opacity: 0.3; }

  /* TOAST */
  #toast { position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%) translateY(80px); background: var(--dark); border: 1px solid rgba(201,146,42,0.4); color: var(--text); padding: 16px 28px; font-size: 0.88rem; z-index: 9998; transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1); border-radius: 2px; max-width: 400px; text-align: center; pointer-events: none; }
  #toast.show { transform: translateX(-50%) translateY(0); }
  #toast.success { border-color: var(--success); color: var(--success); }
  #toast.error { border-color: var(--error); color: #FF8080; }

  .page-footer { background: var(--deep); border-top: 1px solid rgba(201,146,42,0.1); padding: 40px 48px; text-align: center; }
  .page-footer p { font-size: 0.78rem; color: var(--muted); }
  .page-footer a { color: var(--gold); text-decoration: none; }

  @media (max-width: 900px) { .prayer-layout { grid-template-columns: 1fr; padding: 0 24px 80px; } .prayer-feed-wrap { padding-left: 0; margin-top: 48px; } .prayer-form-wrap { padding: 36px 24px; position: static; } nav { padding: 16px 24px; } }
</style>
</head>
<body>
<div id="toast"></div>

<nav>
  <a href="index.html" class="nav-logo">
    <svg class="nav-emblem" viewBox="0 0 42 42" fill="none">
      <circle cx="21" cy="21" r="20" stroke="#C9922A" stroke-width="1.5" opacity="0.4"/>
      <path d="M21 8 C21 8, 30 14, 30 22 C30 28, 25.5 33, 21 34 C16.5 33, 12 28, 12 22 C12 14, 21 8, 21 8Z" fill="rgba(201,146,42,0.15)" stroke="#C9922A" stroke-width="1.2"/>
      <path d="M17 22 Q21 17 25 22" stroke="#F0C060" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <circle cx="21" cy="22" r="2" fill="#F0C060"/>
    </svg>
    <div class="nav-wordmark">LNI Global <span>Lehem Network International</span></div>
  </a>
  <a href="index.html" class="nav-back">‚Üê Back to Home</a>
</nav>

<div class="page-hero">
  <div class="page-hero-bg"></div>
  <div class="page-label">Agree Together</div>
  <h1 class="page-title">Prayer Requests</h1>
  <div class="divider"></div>
  <p class="page-subtitle">The effectual fervent prayer of a righteous man availeth much. Submit your request ‚Äî practitioners across every network will stand with you.</p>
</div>

<div class="prayer-layout">

  <!-- FORM -->
  <div class="prayer-form-wrap">
    <div class="form-section-title">Submit a Prayer Request</div>
    <p class="form-section-sub">Share what you need the LNI family to agree with you on. You can remain anonymous. Public requests will appear in the live prayer feed so others can pray with you.</p>

    <div class="form-group"><label>Your Name</label><input type="text" id="prayerName" placeholder="(Optional ‚Äî leave blank to be anonymous)"/></div>
    <div class="form-group"><label>Country</label><input type="text" id="prayerCountry" placeholder="Your country"/></div>
    <div class="form-group">
      <label>Category</label>
      <select id="prayerCategory">
        <option>Health & Healing</option>
        <option>Family & Relationships</option>
        <option>Provision & Finances</option>
        <option>Ministry & Mission</option>
        <option>Salvation of Loved Ones</option>
        <option>Guidance & Direction</option>
        <option>Protection & Safety</option>
        <option>Other</option>
      </select>
    </div>
    <div class="form-group"><label>Your Prayer Request *</label><textarea id="prayerText" rows="5" placeholder="Share what you need the LNI family to agree with you on..."></textarea></div>

    <div style="margin-bottom: 8px;">
      <label style="display:block;font-size:0.7rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted);margin-bottom:10px;">Visibility</label>
      <div class="visibility-toggle">
        <button class="vis-btn active" id="visPublic" onclick="setVisibility('public')">üåç Public ‚Äî Others Can Pray With Me</button>
        <button class="vis-btn" id="visPrivate" onclick="setVisibility('private')">üîí Private ‚Äî HQ Team Only</button>
      </div>
      <p class="vis-note" id="visNote">Your request will appear in the public prayer feed. Your name will only show if you provided one.</p>
    </div>

    <button class="btn-submit" id="prayerSubmitBtn" onclick="submitPrayer()">Submit Prayer Request ‚Üí</button>
  </div>

  <!-- PRAYER FEED -->
  <div class="prayer-feed-wrap">
    <div class="feed-header">
      <div class="feed-title">Live Prayer Wall</div>
      <span class="feed-count-badge" id="prayerCount">Loading...</span>
    </div>
    <div id="prayerFeed">
      <div class="empty-feed">
        <div class="empty-feed-icon">üôè</div>
        <p>Loading prayer requests...</p>
      </div>
    </div>
  </div>

</div>

<div class="page-footer">
  <p>¬© 2025 Lehem Network International ¬∑ <a href="privacy.html">Privacy Policy</a> ¬∑ <a href="index.html">Back to Home</a></p>
</div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
  import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy, limit, doc, updateDoc, increment } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

  const firebaseConfig = {
    apiKey: "AIzaSyDSTqQrkY5tiSPoNsE12VpFH-aiV-bD2sg",
  authDomain: "lni-global.firebaseapp.com",
  projectId: "lni-global",
  storageBucket: "lni-global.firebasestorage.app",
  messagingSenderId: "1011021757015",
  appId: "1:1011021757015:web:e01c90d5c29925adf6c112"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  window.__db = db;
  window.__addDoc = addDoc;
  window.__collection = collection;
  window.__serverTimestamp = serverTimestamp;
  window.__doc = doc;
  window.__updateDoc = updateDoc;
  window.__increment = increment;

  // Real-time listener for public prayer requests
  const q = query(collection(db, 'prayer_requests'), orderBy('createdAt', 'desc'), limit(20));
  onSnapshot(q, (snapshot) => {
    const prayers = [];
    snapshot.forEach(d => {
      const data = d.data();
      if (data.visibility === 'public') prayers.push({ id: d.id, ...data });
    });
    renderPrayerFeed(prayers);
    document.getElementById('prayerCount').textContent = prayers.length + ' requests';
  }, () => {
    // Firebase not connected yet ‚Äî show fallback
    renderPrayerFeed([]);
    document.getElementById('prayerCount').textContent = '0 requests';
  });

  window.__agreeWithPrayer = async function(prayerId, btn) {
    try {
      await updateDoc(doc(db, 'prayer_requests', prayerId), {
        agreeCount: increment(1)
      });
      btn.textContent = 'üôè Agreed!';
      btn.classList.add('agreed');
      btn.disabled = true;
    } catch(e) { console.log('Agree error:', e); }
  };
</script>

<script>
const WEB3FORMS_KEY = '‚Äé404d0a93-47eb-4d7c-9c54-79d7967eb912';
let currentVisibility = 'public';

function setVisibility(type) {
  currentVisibility = type;
  document.getElementById('visPublic').classList.toggle('active', type === 'public');
  document.getElementById('visPrivate').classList.toggle('active', type === 'private');
  document.getElementById('visNote').textContent = type === 'public'
    ? 'Your request will appear in the public prayer feed. Your name will only show if you provided one.'
    : 'Only the LNI HQ prayer team will see this request. It will not appear publicly.';
}

function showToast(msg, type = 'success') {
  const t = document.getElementById('toast');
  t.textContent = msg; t.className = 'show ' + type;
  clearTimeout(t._t); t._t = setTimeout(() => t.className = '', 4000);
}

async function submitPrayer() {
  const btn = document.getElementById('prayerSubmitBtn');
  const name = document.getElementById('prayerName').value.trim();
  const country = document.getElementById('prayerCountry').value.trim();
  const category = document.getElementById('prayerCategory').value;
  const text = document.getElementById('prayerText').value.trim();

  if (!text || text.length < 10) { showToast('Please write your prayer request.', 'error'); return; }

  btn.disabled = true; btn.textContent = 'Submitting...';

  try {
    if (window.__db) {
      await window.__addDoc(window.__collection(window.__db, 'prayer_requests'), {
        name: name || 'Anonymous',
        country: country || 'Undisclosed',
        category, text,
        visibility: currentVisibility,
        agreeCount: 0,
        createdAt: window.__serverTimestamp()
      });
    }

    if (WEB3FORMS_KEY !== '‚Äé404d0a93-47eb-4d7c-9c54-79d7967eb912') {
      await fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          access_key: WEB3FORMS_KEY,
          subject: 'üôè New Prayer Request ‚Äî ' + category,
          from_name: name || 'Anonymous',
          country, category, text, visibility: currentVisibility,
          form_type: 'Prayer Request'
        })
      });
    }

    showToast('Request submitted. The LNI family is standing with you.', 'success');
    document.getElementById('prayerName').value = '';
    document.getElementById('prayerCountry').value = '';
    document.getElementById('prayerText').value = '';

  } catch(err) {
    showToast('Something went wrong. Please try again.', 'error');
    console.error(err);
  } finally {
    btn.disabled = false; btn.textContent = 'Submit Prayer Request ‚Üí';
  }
}

function formatTime(ts) {
  if (!ts) return 'Just now';
  const date = ts.toDate ? ts.toDate() : new Date(ts);
  const diff = Math.floor((Date.now() - date.getTime()) / 1000);
  if (diff < 60) return 'Just now';
  if (diff < 3600) return Math.floor(diff / 60) + ' min ago';
  if (diff < 86400) return Math.floor(diff / 3600) + ' hr ago';
  return Math.floor(diff / 86400) + ' days ago';
}

function renderPrayerFeed(prayers) {
  const feed = document.getElementById('prayerFeed');
  if (!prayers.length) {
    feed.innerHTML = `<div class="empty-feed"><div class="empty-feed-icon">üôè</div><p>No public requests yet. Be the first to submit one and let the network stand with you.</p></div>`;
    return;
  }
  feed.innerHTML = '';
  prayers.forEach((p, i) => {
    const card = document.createElement('div');
    card.className = 'prayer-card';
    card.style.animationDelay = (i * 0.06) + 's';
    const agreeCount = p.agreeCount || 0;
    card.innerHTML = `
      <div class="prayer-card-meta">
        <span class="prayer-card-name">${p.name || 'Anonymous'}</span>
        <div class="prayer-card-dot"></div>
        <span class="prayer-card-location">${p.country || ''}</span>
        <span class="prayer-card-time">${formatTime(p.createdAt)}</span>
      </div>
      <div class="prayer-card-text">${p.text}</div>
      <div class="prayer-card-category">${p.category}</div>
      <button class="agree-btn" id="agree-${p.id}" onclick="agreeWith('${p.id}', this)">
        üôè Agree in Prayer ${agreeCount > 0 ? '(' + agreeCount + ')' : ''}
      </button>
    `;
    feed.appendChild(card);
  });
}

function agreeWith(id, btn) {
  if (window.__agreeWithPrayer) {
    window.__agreeWithPrayer(id, btn);
  } else {
    btn.textContent = 'üôè Agreed!';
    btn.classList.add('agreed');
    btn.disabled = true;
  }
}

// Show empty state while loading
renderPrayerFeed([]);
</script>
</body>
</html>

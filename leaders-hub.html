<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LNI Leaders Portal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cinzel+Decorative:wght@700&family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400&display=swap" rel="stylesheet">

<style>
:root {
  --gold: #C9922A;
  --gold-light: #F0C060;
  --gold-pale: #FAE8B0;
  --deep: #0A0604;
  --dark: #1A1208;
  --mid: #2A1F0E;
  --warm: #3A2A12;
  --text: #EDE0C8;
  --muted: #9A8870;
  --danger: #E05050;
  --success: #4A9A6A;
  --info: #4A80C0;
  --warn: #C88030;
  --radius: 8px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Lato', sans-serif;
  background: var(--deep);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ NOISE TEXTURE â”€â”€ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#auth-screen {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--deep);
  z-index: 1000;
  padding: 24px;
}

.auth-card {
  background: var(--dark);
  border: 1px solid rgba(201,146,42,0.2);
  border-radius: 16px;
  padding: 48px 40px;
  width: 100%;
  max-width: 440px;
  position: relative;
  overflow: hidden;
}

.auth-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
}

.auth-emblem {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 32px;
}

.auth-emblem svg { width: 44px; height: 44px; }

.auth-emblem-text h1 {
  font-family: 'Cinzel Decorative', serif;
  font-size: 14px;
  color: var(--gold-pale);
  letter-spacing: 0.05em;
}

.auth-emblem-text p {
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 0.2em;
  text-transform: uppercase;
}

.auth-card h2 {
  font-family: 'Cinzel', serif;
  font-size: 22px;
  color: var(--gold-pale);
  margin-bottom: 6px;
}

.auth-card p.auth-sub {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 28px;
  line-height: 1.6;
}

.field-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 16px;
}

.field-group label {
  font-size: 11px;
  color: var(--muted);
  letter-spacing: 0.1em;
  text-transform: uppercase;
}

.field-group input {
  background: var(--mid);
  border: 1px solid rgba(201,146,42,0.15);
  border-radius: var(--radius);
  padding: 12px 14px;
  color: var(--text);
  font-family: 'Lato', sans-serif;
  font-size: 14px;
  outline: none;
  transition: border-color 0.2s;
  width: 100%;
}

.field-group input:focus {
  border-color: var(--gold);
}

.btn-primary {
  width: 100%;
  padding: 14px;
  background: var(--gold);
  border: none;
  border-radius: var(--radius);
  color: var(--deep);
  font-family: 'Cinzel', serif;
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.1em;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 8px;
}

.btn-primary:hover { background: var(--gold-light); transform: translateY(-1px); }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

.auth-error {
  background: rgba(224,80,80,0.1);
  border: 1px solid rgba(224,80,80,0.3);
  border-radius: var(--radius);
  padding: 10px 14px;
  color: #F08080;
  font-size: 13px;
  margin-bottom: 14px;
  display: none;
}

.auth-forgot {
  text-align: center;
  margin-top: 16px;
  font-size: 12px;
  color: var(--muted);
}

.auth-forgot a {
  color: var(--gold);
  text-decoration: none;
  cursor: pointer;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app { display: none; min-height: 100vh; }

.app-layout {
  display: grid;
  grid-template-columns: 260px 1fr;
  min-height: 100vh;
}

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar {
  background: var(--dark);
  border-right: 1px solid rgba(201,146,42,0.1);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  width: 260px;
  z-index: 100;
  overflow-y: auto;
}

.sidebar-logo {
  padding: 24px 20px;
  border-bottom: 1px solid rgba(201,146,42,0.1);
  display: flex;
  align-items: center;
  gap: 12px;
}

.sidebar-logo svg { width: 36px; height: 36px; flex-shrink: 0; }

.sidebar-logo-text h1 {
  font-family: 'Cinzel Decorative', serif;
  font-size: 11px;
  color: var(--gold-pale);
  line-height: 1.3;
}

.sidebar-logo-text p {
  font-size: 9px;
  color: var(--muted);
  letter-spacing: 0.15em;
  text-transform: uppercase;
}

/* Leader identity card in sidebar */
.leader-card {
  padding: 16px 20px;
  border-bottom: 1px solid rgba(201,146,42,0.08);
}

.leader-avatar {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--gold), var(--warm));
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Cinzel', serif;
  font-size: 16px;
  color: var(--deep);
  font-weight: 700;
  margin-bottom: 10px;
}

.leader-card h3 {
  font-size: 13px;
  color: var(--gold-pale);
  font-family: 'Cinzel', serif;
  margin-bottom: 2px;
}

.leader-card p {
  font-size: 11px;
  color: var(--muted);
  margin-bottom: 2px;
}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 10px;
  padding: 2px 8px;
  border-radius: 20px;
  margin-top: 4px;
}

.status-badge.active {
  background: rgba(74,154,106,0.15);
  color: #6ACA8A;
  border: 1px solid rgba(74,154,106,0.3);
}

.status-badge::before {
  content: '';
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: currentColor;
}

/* Nav */
.sidebar-nav {
  flex: 1;
  padding: 12px 0;
}

.nav-section-label {
  font-size: 9px;
  color: var(--muted);
  letter-spacing: 0.2em;
  text-transform: uppercase;
  padding: 12px 20px 4px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 20px;
  cursor: pointer;
  transition: all 0.15s;
  border-left: 3px solid transparent;
  font-size: 13px;
  color: var(--muted);
  position: relative;
}

.nav-item:hover {
  background: rgba(201,146,42,0.05);
  color: var(--text);
}

.nav-item.active {
  background: rgba(201,146,42,0.08);
  color: var(--gold-pale);
  border-left-color: var(--gold);
}

.nav-item svg { width: 16px; height: 16px; flex-shrink: 0; }

.nav-badge {
  margin-left: auto;
  background: var(--gold);
  color: var(--deep);
  font-size: 9px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 10px;
  min-width: 18px;
  text-align: center;
}

.sidebar-footer {
  padding: 16px 20px;
  border-top: 1px solid rgba(201,146,42,0.08);
}

.btn-logout {
  width: 100%;
  padding: 9px;
  background: transparent;
  border: 1px solid rgba(201,146,42,0.2);
  border-radius: var(--radius);
  color: var(--muted);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-logout:hover {
  border-color: var(--danger);
  color: var(--danger);
}

/* â”€â”€ MAIN CONTENT â”€â”€ */
.main-content {
  margin-left: 260px;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

.topbar {
  background: var(--dark);
  border-bottom: 1px solid rgba(201,146,42,0.1);
  padding: 16px 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 50;
}

.topbar-title h2 {
  font-family: 'Cinzel', serif;
  font-size: 16px;
  color: var(--gold-pale);
}

.topbar-title p {
  font-size: 12px;
  color: var(--muted);
  margin-top: 2px;
}

.topbar-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.notif-bell {
  position: relative;
  width: 36px;
  height: 36px;
  background: var(--mid);
  border: 1px solid rgba(201,146,42,0.15);
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.notif-bell:hover { border-color: var(--gold); }

.notif-dot {
  position: absolute;
  top: 6px; right: 6px;
  width: 8px; height: 8px;
  background: var(--gold);
  border-radius: 50%;
  border: 2px solid var(--dark);
}

/* â”€â”€ PANELS â”€â”€ */
.panel { display: none; padding: 32px; }
.panel.active { display: block; }

/* â”€â”€ SECTION HEADER â”€â”€ */
.section-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 12px;
}

.section-header h2 {
  font-family: 'Cinzel', serif;
  font-size: 20px;
  color: var(--gold-pale);
}

.section-header p {
  font-size: 13px;
  color: var(--muted);
  margin-top: 3px;
  line-height: 1.5;
}

/* â”€â”€ STAT CARDS â”€â”€ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 16px;
  margin-bottom: 28px;
}

.stat-card {
  background: var(--dark);
  border: 1px solid rgba(201,146,42,0.12);
  border-radius: var(--radius);
  padding: 20px;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
}

.stat-card.gold::before { background: var(--gold); }
.stat-card.blue::before { background: var(--info); }
.stat-card.green::before { background: var(--success); }
.stat-card.orange::before { background: var(--warn); }

.stat-icon {
  font-size: 20px;
  margin-bottom: 10px;
}

.stat-value {
  font-family: 'Cinzel', serif;
  font-size: 28px;
  color: var(--gold-pale);
  line-height: 1;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 11px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.stat-change {
  font-size: 11px;
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 4px;
}

.stat-change.up { color: var(--success); }
.stat-change.neutral { color: var(--muted); }

/* â”€â”€ CARDS â”€â”€ */
.card {
  background: var(--dark);
  border: 1px solid rgba(201,146,42,0.12);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 20px;
}

.card-header {
  padding: 16px 20px;
  border-bottom: 1px solid rgba(201,146,42,0.08);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.card-header h3 {
  font-family: 'Cinzel', serif;
  font-size: 13px;
  color: var(--gold-pale);
}

.card-body { padding: 20px; }

/* â”€â”€ GRID LAYOUTS â”€â”€ */
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

/* â”€â”€ ANNOUNCEMENT CARD â”€â”€ */
.announcement-item {
  padding: 14px 16px;
  border-left: 3px solid var(--gold);
  background: rgba(201,146,42,0.04);
  border-radius: 0 var(--radius) var(--radius) 0;
  margin-bottom: 10px;
}

.announcement-item .ann-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.ann-tag {
  font-size: 9px;
  padding: 2px 8px;
  border-radius: 20px;
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.ann-tag.important { background: rgba(224,80,80,0.15); color: #F08080; border: 1px solid rgba(224,80,80,0.3); }
.ann-tag.update { background: rgba(74,128,192,0.15); color: #80B0E0; border: 1px solid rgba(74,128,192,0.3); }
.ann-tag.reminder { background: rgba(200,128,48,0.15); color: #E0A060; border: 1px solid rgba(200,128,48,0.3); }
.ann-tag.celebration { background: rgba(74,154,106,0.15); color: #6ACA8A; border: 1px solid rgba(74,154,106,0.3); }

.ann-date { font-size: 11px; color: var(--muted); }
.announcement-item h4 { font-size: 14px; color: var(--gold-pale); margin-bottom: 5px; }
.announcement-item p { font-size: 13px; color: var(--text); line-height: 1.6; }

/* â”€â”€ FORMS â”€â”€ */
.form-section { margin-bottom: 28px; }

.form-section-title {
  font-family: 'Cinzel', serif;
  font-size: 12px;
  color: var(--gold);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(201,146,42,0.15);
  margin-bottom: 16px;
}

.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.form-grid.three { grid-template-columns: 1fr 1fr 1fr; }
.form-grid.single { grid-template-columns: 1fr; }

.field {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.field label {
  font-size: 11px;
  color: var(--muted);
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.field input,
.field select,
.field textarea {
  background: var(--mid);
  border: 1px solid rgba(201,146,42,0.15);
  border-radius: var(--radius);
  padding: 10px 14px;
  color: var(--text);
  font-family: 'Lato', sans-serif;
  font-size: 13px;
  outline: none;
  transition: border-color 0.2s;
  width: 100%;
}

.field input:focus,
.field select:focus,
.field textarea:focus {
  border-color: var(--gold);
}

.field textarea { resize: vertical; min-height: 80px; }

.field select option { background: var(--dark); }

.btn-gold {
  padding: 12px 24px;
  background: var(--gold);
  border: none;
  border-radius: var(--radius);
  color: var(--deep);
  font-family: 'Cinzel', serif;
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 0.08em;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-gold:hover { background: var(--gold-light); transform: translateY(-1px); }
.btn-gold:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

.btn-outline {
  padding: 10px 20px;
  background: transparent;
  border: 1px solid rgba(201,146,42,0.3);
  border-radius: var(--radius);
  color: var(--gold);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-outline:hover { border-color: var(--gold); background: rgba(201,146,42,0.08); }

.btn-danger {
  padding: 9px 18px;
  background: transparent;
  border: 1px solid rgba(224,80,80,0.3);
  border-radius: var(--radius);
  color: #F08080;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-danger:hover { background: rgba(224,80,80,0.1); }

/* â”€â”€ REPORT HISTORY â”€â”€ */
.report-item {
  padding: 14px 16px;
  border: 1px solid rgba(201,146,42,0.1);
  border-radius: var(--radius);
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.report-item:hover { border-color: rgba(201,146,42,0.3); background: rgba(201,146,42,0.03); }

.report-item-left { display: flex; align-items: center; gap: 12px; }

.report-month-badge {
  background: var(--warm);
  border-radius: 6px;
  padding: 6px 10px;
  text-align: center;
  min-width: 52px;
}

.report-month-badge .month { font-size: 10px; color: var(--gold); text-transform: uppercase; letter-spacing: 0.08em; }
.report-month-badge .year { font-size: 12px; color: var(--gold-pale); font-weight: 700; }

.report-meta h4 { font-size: 13px; color: var(--text); margin-bottom: 3px; }
.report-meta p { font-size: 11px; color: var(--muted); }

.report-status {
  font-size: 11px;
  padding: 3px 10px;
  border-radius: 20px;
}

.report-status.submitted { background: rgba(74,128,192,0.15); color: #80B0E0; border: 1px solid rgba(74,128,192,0.3); }
.report-status.reviewed { background: rgba(74,154,106,0.15); color: #6ACA8A; border: 1px solid rgba(74,154,106,0.3); }
.report-status.needs-action { background: rgba(224,80,80,0.15); color: #F08080; border: 1px solid rgba(224,80,80,0.3); }

/* â”€â”€ MESSAGE THREAD â”€â”€ */
.message-thread { display: flex; flex-direction: column; gap: 12px; max-height: 400px; overflow-y: auto; padding-right: 4px; }

.message-bubble {
  max-width: 75%;
  padding: 12px 16px;
  border-radius: 12px;
  position: relative;
}

.message-bubble.from-hq {
  background: var(--warm);
  border-radius: 4px 12px 12px 12px;
  align-self: flex-start;
  border-left: 3px solid var(--gold);
}

.message-bubble.from-me {
  background: rgba(201,146,42,0.15);
  border-radius: 12px 4px 12px 12px;
  align-self: flex-end;
  border-right: 3px solid var(--gold);
}

.message-sender { font-size: 10px; color: var(--gold); margin-bottom: 4px; font-weight: 700; letter-spacing: 0.05em; }
.message-text { font-size: 13px; color: var(--text); line-height: 1.6; }
.message-time { font-size: 10px; color: var(--muted); margin-top: 5px; text-align: right; }

.message-input-area {
  display: flex;
  gap: 10px;
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid rgba(201,146,42,0.1);
}

.message-input-area textarea {
  flex: 1;
  background: var(--mid);
  border: 1px solid rgba(201,146,42,0.15);
  border-radius: var(--radius);
  padding: 10px 14px;
  color: var(--text);
  font-family: 'Lato', sans-serif;
  font-size: 13px;
  resize: none;
  height: 44px;
  outline: none;
  transition: border-color 0.2s;
}

.message-input-area textarea:focus { border-color: var(--gold); }

/* â”€â”€ RESOURCE CARDS â”€â”€ */
.resource-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 14px; }

.resource-card {
  background: var(--mid);
  border: 1px solid rgba(201,146,42,0.1);
  border-radius: var(--radius);
  padding: 20px;
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
  display: block;
}

.resource-card:hover {
  border-color: rgba(201,146,42,0.35);
  transform: translateY(-2px);
}

.resource-icon { font-size: 28px; margin-bottom: 12px; }
.resource-card h4 { font-size: 13px; color: var(--gold-pale); margin-bottom: 5px; }
.resource-card p { font-size: 11px; color: var(--muted); line-height: 1.5; }

/* â”€â”€ PRAYER REQUESTS â”€â”€ */
.prayer-item {
  padding: 14px 16px;
  border: 1px solid rgba(201,146,42,0.1);
  border-radius: var(--radius);
  margin-bottom: 8px;
}

.prayer-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap; }
.prayer-network { font-size: 10px; color: var(--gold); font-weight: 700; letter-spacing: 0.05em; }
.prayer-date { font-size: 10px; color: var(--muted); }
.prayer-text { font-size: 13px; color: var(--text); line-height: 1.6; }

/* â”€â”€ GOAL TRACKER â”€â”€ */
.goal-item {
  margin-bottom: 16px;
}

.goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
.goal-label { font-size: 13px; color: var(--text); }
.goal-numbers { font-size: 12px; color: var(--muted); }

.progress-bar-bg {
  height: 6px;
  background: var(--warm);
  border-radius: 3px;
  overflow: hidden;
}

.progress-bar-fill {
  height: 100%;
  border-radius: 3px;
  background: linear-gradient(90deg, var(--gold), var(--gold-light));
  transition: width 0.8s ease;
}

/* â”€â”€ TOAST â”€â”€ */
#toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.toast-item {
  padding: 12px 20px;
  border-radius: var(--radius);
  font-size: 13px;
  animation: toastIn 0.3s ease;
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 260px;
}

.toast-item.success { background: rgba(74,154,106,0.9); color: white; }
.toast-item.error { background: rgba(224,80,80,0.9); color: white; }
.toast-item.info { background: rgba(74,128,192,0.9); color: white; }

@keyframes toastIn { from { opacity:0; transform: translateX(20px); } to { opacity:1; transform:translateX(0); } }

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 500;
  padding: 24px;
  display: none;
}

.modal-overlay.open { display: flex; }

.modal-box {
  background: var(--dark);
  border: 1px solid rgba(201,146,42,0.2);
  border-radius: 12px;
  padding: 32px;
  width: 100%;
  max-width: 560px;
  max-height: 85vh;
  overflow-y: auto;
  position: relative;
}

.modal-box h3 {
  font-family: 'Cinzel', serif;
  font-size: 16px;
  color: var(--gold-pale);
  margin-bottom: 16px;
}

.modal-close {
  position: absolute;
  top: 16px; right: 16px;
  width: 28px; height: 28px;
  background: var(--warm);
  border: none;
  border-radius: 50%;
  color: var(--muted);
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-close:hover { color: var(--text); }

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty-state {
  text-align: center;
  padding: 48px 24px;
  color: var(--muted);
}

.empty-state .empty-icon { font-size: 40px; margin-bottom: 12px; }
.empty-state p { font-size: 14px; }

/* â”€â”€ DIVIDER â”€â”€ */
.gold-divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(201,146,42,0.3), transparent);
  margin: 24px 0;
}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media (max-width: 900px) {
  .app-layout { grid-template-columns: 1fr; }
  .sidebar { display: none; }
  .main-content { margin-left: 0; }
  .two-col, .three-col, .form-grid { grid-template-columns: 1fr; }
  .panel { padding: 20px; }
}

/* â”€â”€ SCROLLBAR â”€â”€ */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--warm); border-radius: 2px; }

/* â”€â”€ UTILITY â”€â”€ */
.flex { display: flex; }
.flex-between { display: flex; justify-content: space-between; align-items: center; }
.gap-10 { gap: 10px; }
.mt-8 { margin-top: 8px; }
.mt-16 { margin-top: 16px; }
.mb-16 { margin-bottom: 16px; }
.text-muted { color: var(--muted); font-size: 12px; }
.text-gold { color: var(--gold); }
.text-success { color: var(--success); }
.text-danger { color: var(--danger); }
.full-width { width: 100%; }
hr.subtle { border: none; border-top: 1px solid rgba(201,146,42,0.08); margin: 16px 0; }

/* â”€â”€ LOADING SPINNER â”€â”€ */
.spinner {
  width: 20px; height: 20px;
  border: 2px solid rgba(201,146,42,0.2);
  border-top-color: var(--gold);
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
  display: inline-block;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Prayer wall toggle */
.tab-row {
  display: flex;
  gap: 4px;
  background: var(--warm);
  padding: 4px;
  border-radius: var(--radius);
  margin-bottom: 20px;
  width: fit-content;
}

.tab-btn {
  padding: 7px 16px;
  border: none;
  border-radius: 6px;
  background: transparent;
  color: var(--muted);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s;
}

.tab-btn.active { background: var(--gold); color: var(--deep); font-weight: 700; }

/* File upload zone */
.upload-zone {
  border: 2px dashed rgba(201,146,42,0.25);
  border-radius: var(--radius);
  padding: 24px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
}

.upload-zone:hover { border-color: var(--gold); background: rgba(201,146,42,0.04); }
.upload-zone p { font-size: 13px; color: var(--muted); margin-top: 8px; }
.upload-zone .upload-icon { font-size: 28px; }

</style>
</head>
<body>

<div id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUTH SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="auth-screen">
  <div class="auth-card">
    <div class="auth-emblem">
      <svg viewBox="0 0 42 42" fill="none">
        <circle cx="21" cy="21" r="20" stroke="#C9922A" stroke-width="1.5" opacity="0.4"/>
        <path d="M21 8 C21 8, 30 14, 30 22 C30 28, 25.5 33, 21 34 C16.5 33, 12 28, 12 22 C12 14, 21 8, 21 8Z" fill="rgba(201,146,42,0.15)" stroke="#C9922A" stroke-width="1.2"/>
        <path d="M17 22 Q21 17 25 22" stroke="#F0C060" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <circle cx="21" cy="22" r="2" fill="#F0C060"/>
      </svg>
      <div class="auth-emblem-text">
        <h1>LNI Global</h1>
        <p>Lehem Network International</p>
      </div>
    </div>
    <h2>Network Leaders Portal</h2>
    <p class="auth-sub">Sign in with your LNI credentials to access your network dashboard, submit reports, and connect with HQ.</p>
    <div class="auth-error" id="auth-error">Invalid email or password. Please try again.</div>
    <div class="field-group">
      <label>Email Address</label>
      <input type="email" id="login-email" placeholder="your@email.com" autocomplete="email">
    </div>
    <div class="field-group">
      <label>Password</label>
      <input type="password" id="login-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
    </div>
    <button class="btn-primary" id="login-btn" onclick="doLogin()">Sign In to Portal</button>
    <div class="auth-forgot">
      Forgot your password? <a onclick="doPasswordReset()">Reset via email</a>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
  <div class="app-layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <svg viewBox="0 0 42 42" fill="none">
          <circle cx="21" cy="21" r="20" stroke="#C9922A" stroke-width="1.5" opacity="0.4"/>
          <path d="M21 8 C21 8, 30 14, 30 22 C30 28, 25.5 33, 21 34 C16.5 33, 12 28, 12 22 C12 14, 21 8, 21 8Z" fill="rgba(201,146,42,0.15)" stroke="#C9922A" stroke-width="1.2"/>
          <path d="M17 22 Q21 17 25 22" stroke="#F0C060" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <circle cx="21" cy="22" r="2" fill="#F0C060"/>
        </svg>
        <div class="sidebar-logo-text">
          <h1>LNI Global</h1>
          <p>Leaders Portal</p>
        </div>
      </div>

      <div class="leader-card">
        <div class="leader-avatar" id="sidebar-avatar">â€“</div>
        <h3 id="sidebar-name">Loading...</h3>
        <p id="sidebar-network">Network</p>
        <p id="sidebar-city" style="font-size:10px;color:var(--muted)">City, Country</p>
        <span class="status-badge active">Active Leader</span>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section-label">My Network</div>
        <div class="nav-item active" onclick="showPanel('dashboard')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
          Dashboard
        </div>
        <div class="nav-item" onclick="showPanel('submit-report')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
          Submit Report
        </div>
        <div class="nav-item" onclick="showPanel('my-reports')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
          My Reports
        </div>
        <div class="nav-item" onclick="showPanel('my-goals')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          Network Goals
        </div>
        <div class="nav-section-label">Connect with HQ</div>
        <div class="nav-item" onclick="showPanel('messages')" id="nav-messages">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
          Messages
          <span class="nav-badge" id="msg-badge" style="display:none">0</span>
        </div>
        <div class="nav-item" onclick="showPanel('announcements')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 17H2a3 3 0 000 6h20a3 3 0 000-6zM8 12l-4-8h16l-4 8z"/></svg>
          Announcements
        </div>
        <div class="nav-item" onclick="showPanel('prayer-wall')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8h1a4 4 0 010 8h-1"/><path d="M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
          Network Prayer
        </div>
        <div class="nav-section-label">Resources</div>
        <div class="nav-item" onclick="showPanel('resources')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
          Toolkit & Docs
        </div>
        <div class="nav-item" onclick="showPanel('profile')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          My Profile
        </div>
      </nav>

      <div class="sidebar-footer">
        <button class="btn-logout" onclick="doLogout()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          Sign Out
        </button>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <div class="topbar">
        <div class="topbar-title">
          <h2 id="topbar-title">Dashboard</h2>
          <p id="topbar-subtitle">Welcome back</p>
        </div>
        <div class="topbar-actions">
          <div class="notif-bell" onclick="showPanel('announcements')" title="Announcements">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/></svg>
            <div class="notif-dot"></div>
          </div>
          <button class="btn-outline" onclick="showPanel('submit-report')" style="font-size:11px;padding:8px 14px;">
            + Submit Report
          </button>
        </div>
      </div>

      <!-- â”€â”€ DASHBOARD â”€â”€ -->
      <div class="panel active" id="panel-dashboard">
        <div class="section-header">
          <div>
            <h2 id="dash-welcome">Network Dashboard</h2>
            <p id="dash-network-name">Loading your network overview...</p>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card gold">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-value" id="stat-members">â€“</div>
            <div class="stat-label">Active Members</div>
            <div class="stat-change neutral" id="stat-members-change">Update in latest report</div>
          </div>
          <div class="stat-card blue">
            <div class="stat-icon">ğŸ›ï¸</div>
            <div class="stat-value" id="stat-gatherings">â€“</div>
            <div class="stat-label">Gatherings This Month</div>
            <div class="stat-change neutral">Last reported</div>
          </div>
          <div class="stat-card green">
            <div class="stat-icon">âœ¦</div>
            <div class="stat-value" id="stat-testimonies">â€“</div>
            <div class="stat-label">Testimonies</div>
            <div class="stat-change neutral">Total recorded</div>
          </div>
          <div class="stat-card orange">
            <div class="stat-icon">ğŸ“‹</div>
            <div class="stat-value" id="stat-reports">â€“</div>
            <div class="stat-label">Reports Submitted</div>
            <div class="stat-change neutral">All time</div>
          </div>
        </div>

        <div class="two-col">
          <!-- Announcements preview -->
          <div class="card">
            <div class="card-header">
              <h3>ğŸ“¢ Latest from HQ</h3>
              <span class="btn-outline" style="font-size:11px;padding:5px 12px;cursor:pointer" onclick="showPanel('announcements')">View All</span>
            </div>
            <div class="card-body" id="dash-announcements">
              <div class="empty-state"><div class="empty-icon">ğŸ“­</div><p>No announcements yet</p></div>
            </div>
          </div>

          <!-- Recent messages preview -->
          <div class="card">
            <div class="card-header">
              <h3>ğŸ’¬ Recent Messages</h3>
              <span class="btn-outline" style="font-size:11px;padding:5px 12px;cursor:pointer" onclick="showPanel('messages')">Open</span>
            </div>
            <div class="card-body" id="dash-messages-preview">
              <div class="empty-state"><div class="empty-icon">ğŸ’¬</div><p>No messages yet</p></div>
            </div>
          </div>
        </div>

        <!-- Network Goals -->
        <div class="card">
          <div class="card-header">
            <h3>ğŸ¯ Network Goals Progress</h3>
            <span onclick="showPanel('my-goals')" style="font-size:11px;color:var(--gold);cursor:pointer">Edit Goals â†’</span>
          </div>
          <div class="card-body" id="dash-goals">
            <div class="empty-state"><div class="empty-icon">ğŸ¯</div><p>Set your network goals in the Goals section</p></div>
          </div>
        </div>

        <!-- Last report summary -->
        <div class="card" id="last-report-card" style="display:none">
          <div class="card-header">
            <h3>ğŸ“‹ Last Report Summary</h3>
            <span id="last-report-status" class="report-status submitted">Submitted</span>
          </div>
          <div class="card-body" id="last-report-body"></div>
        </div>
      </div>

      <!-- â”€â”€ SUBMIT REPORT â”€â”€ -->
      <div class="panel" id="panel-submit-report">
        <div class="section-header">
          <div>
            <h2>Submit Monthly Report</h2>
            <p>Complete every section honestly. Reports go directly to LNI HQ and are reviewed personally.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="form-section">
              <div class="form-section-title">Report Period</div>
              <div class="form-grid three">
                <div class="field">
                  <label>Month</label>
                  <select id="r-month">
                    <option value="">Select Month</option>
                    <option>January</option><option>February</option><option>March</option>
                    <option>April</option><option>May</option><option>June</option>
                    <option>July</option><option>August</option><option>September</option>
                    <option>October</option><option>November</option><option>December</option>
                  </select>
                </div>
                <div class="field">
                  <label>Year</label>
                  <select id="r-year">
                    <option>2025</option><option>2026</option><option>2027</option>
                  </select>
                </div>
                <div class="field">
                  <label>Network / City</label>
                  <input type="text" id="r-network-display" readonly style="opacity:0.6">
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-title">Network Numbers</div>
              <div class="form-grid">
                <div class="field">
                  <label>Active Members This Month</label>
                  <input type="number" id="r-members" placeholder="e.g. 24" min="0">
                </div>
                <div class="field">
                  <label>New Members Added</label>
                  <input type="number" id="r-new-members" placeholder="e.g. 3" min="0">
                </div>
                <div class="field">
                  <label>Gatherings Held</label>
                  <input type="number" id="r-gatherings" placeholder="e.g. 4" min="0">
                </div>
                <div class="field">
                  <label>Average Attendance Per Gathering</label>
                  <input type="number" id="r-avg-attendance" placeholder="e.g. 18" min="0">
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-title">Kingdom Activity</div>
              <div class="form-grid">
                <div class="field">
                  <label>Salvations This Month</label>
                  <input type="number" id="r-salvations" placeholder="e.g. 2" min="0">
                </div>
                <div class="field">
                  <label>Healings / Miracles Recorded</label>
                  <input type="number" id="r-miracles" placeholder="e.g. 1" min="0">
                </div>
                <div class="field">
                  <label>Outreach Events</label>
                  <input type="number" id="r-outreach" placeholder="e.g. 1" min="0">
                </div>
                <div class="field">
                  <label>Disciples Currently in Training</label>
                  <input type="number" id="r-disciples" placeholder="e.g. 6" min="0">
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-title">Narrative Report</div>
              <div class="form-grid single">
                <div class="field">
                  <label>Testimonies & Highlights â€” What did God do this month?</label>
                  <textarea id="r-testimonies" rows="4" placeholder="Share the standout stories from your network this month..."></textarea>
                </div>
                <div class="field">
                  <label>Challenges & Prayer Points â€” What is the network facing?</label>
                  <textarea id="r-challenges" rows="3" placeholder="Be honest about what is hard. HQ wants to pray with you and support you..."></textarea>
                </div>
                <div class="field">
                  <label>Support Needed from HQ â€” How can we serve you?</label>
                  <textarea id="r-support" rows="3" placeholder="Teaching, pastoral support, resources, connections â€” be specific..."></textarea>
                </div>
                <div class="field">
                  <label>Vision for Next Month â€” What are you believing God for?</label>
                  <textarea id="r-vision" rows="3" placeholder="What is your faith expectation for the coming month?"></textarea>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-title">Attachments (Optional)</div>
              <div class="upload-zone" onclick="document.getElementById('r-file').click()">
                <div class="upload-icon">ğŸ“</div>
                <p>Click to attach photos, documents, or media from your network gatherings</p>
                <p style="font-size:11px;margin-top:4px;color:var(--muted)">PDF, JPG, PNG â€” Max 10MB</p>
                <input type="file" id="r-file" style="display:none" accept=".pdf,.jpg,.png,.jpeg" multiple>
              </div>
              <p class="text-muted mt-8" id="r-file-label">No files selected</p>
            </div>

            <div class="flex-between">
              <button class="btn-outline" onclick="saveDraft()">Save Draft</button>
              <button class="btn-gold" id="submit-report-btn" onclick="submitReport()">Submit Report to HQ â†’</button>
            </div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ MY REPORTS â”€â”€ -->
      <div class="panel" id="panel-my-reports">
        <div class="section-header">
          <div>
            <h2>My Report History</h2>
            <p>All reports you have submitted to LNI HQ. Click any report to view details and HQ feedback.</p>
          </div>
        </div>
        <div class="card">
          <div class="card-body" id="reports-list">
            <div class="empty-state"><div class="spinner"></div><p style="margin-top:12px">Loading reports...</p></div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ NETWORK GOALS â”€â”€ -->
      <div class="panel" id="panel-my-goals">
        <div class="section-header">
          <div>
            <h2>Network Goals</h2>
            <p>Set targets for your network. These display on your dashboard and help HQ understand your vision.</p>
          </div>
        </div>
        <div class="two-col">
          <div class="card">
            <div class="card-header"><h3>Set / Update Goals</h3></div>
            <div class="card-body">
              <div class="form-grid single">
                <div class="field"><label>Target Members by Year End</label><input type="number" id="g-members" placeholder="e.g. 50" min="0"></div>
                <div class="field"><label>Target Monthly Gatherings</label><input type="number" id="g-gatherings" placeholder="e.g. 6" min="0"></div>
                <div class="field"><label>Target Salvations This Year</label><input type="number" id="g-salvations" placeholder="e.g. 20" min="0"></div>
                <div class="field"><label>Target Disciples in Training</label><input type="number" id="g-disciples" placeholder="e.g. 12" min="0"></div>
                <div class="field"><label>One-Year Vision Statement</label><textarea id="g-vision" rows="3" placeholder="Where do you believe God is taking your network in the next 12 months?"></textarea></div>
              </div>
              <button class="btn-gold full-width mt-16" onclick="saveGoals()">Save Goals</button>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><h3>Current Progress</h3></div>
            <div class="card-body" id="goals-progress">
              <div class="empty-state"><div class="empty-icon">ğŸ¯</div><p>Set goals to see progress tracking</p></div>
            </div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ MESSAGES â”€â”€ -->
      <div class="panel" id="panel-messages">
        <div class="section-header">
          <div>
            <h2>Messages with HQ</h2>
            <p>Direct communication channel between you and Lehem Network International headquarters.</p>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <div class="message-thread" id="message-thread">
              <div class="empty-state"><div class="empty-icon">ğŸ’¬</div><p>No messages yet. Start a conversation with HQ below.</p></div>
            </div>
            <div class="message-input-area">
              <textarea id="msg-input" placeholder="Message HQ..." rows="1" onkeydown="handleMsgKey(event)"></textarea>
              <button class="btn-gold" style="padding:10px 18px;flex-shrink:0" onclick="sendMessage()">Send</button>
            </div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ ANNOUNCEMENTS â”€â”€ -->
      <div class="panel" id="panel-announcements">
        <div class="section-header">
          <div>
            <h2>Announcements from HQ</h2>
            <p>Official communications, updates, and calls to prayer from Lehem Network International.</p>
          </div>
        </div>
        <div class="card">
          <div class="card-body" id="announcements-list">
            <div class="empty-state"><div class="spinner"></div><p style="margin-top:12px">Loading announcements...</p></div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ PRAYER WALL â”€â”€ -->
      <div class="panel" id="panel-prayer-wall">
        <div class="section-header">
          <div>
            <h2>Network Prayer Wall</h2>
            <p>Share prayer requests with the wider network of leaders. Carry each other's burdens.</p>
          </div>
        </div>

        <div class="tab-row">
          <button class="tab-btn active" onclick="switchPrayerTab('all', this)">All Requests</button>
          <button class="tab-btn" onclick="switchPrayerTab('mine', this)">My Requests</button>
          <button class="tab-btn" onclick="switchPrayerTab('submit', this)">+ New Request</button>
        </div>

        <div id="prayer-tab-all">
          <div class="card">
            <div class="card-body" id="prayer-list">
              <div class="empty-state"><div class="spinner"></div></div>
            </div>
          </div>
        </div>

        <div id="prayer-tab-mine" style="display:none">
          <div class="card">
            <div class="card-body" id="prayer-mine-list">
              <div class="empty-state"><div class="empty-icon">ğŸ™</div><p>No requests yet</p></div>
            </div>
          </div>
        </div>

        <div id="prayer-tab-submit" style="display:none">
          <div class="card">
            <div class="card-header"><h3>Share a Prayer Request</h3></div>
            <div class="card-body">
              <div class="form-grid single">
                <div class="field"><label>Category</label>
                  <select id="p-category">
                    <option>Network Growth</option><option>Personal / Family</option>
                    <option>Finance & Provision</option><option>Health & Healing</option>
                    <option>Spiritual Breakthrough</option><option>Salvation of Souls</option>
                    <option>Protection & Safety</option><option>Other</option>
                  </select>
                </div>
                <div class="field"><label>Your Prayer Request</label>
                  <textarea id="p-text" rows="4" placeholder="Share your prayer need with your fellow network leaders..."></textarea>
                </div>
                <div class="field">
                  <label>Visibility</label>
                  <select id="p-visibility">
                    <option value="network">Visible to all Network Leaders</option>
                    <option value="hq">HQ Only (Private)</option>
                  </select>
                </div>
              </div>
              <button class="btn-gold mt-16" onclick="submitPrayer()">Submit Prayer Request</button>
            </div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ RESOURCES â”€â”€ -->
      <div class="panel" id="panel-resources">
        <div class="section-header">
          <div>
            <h2>Toolkit & Resources</h2>
            <p>Official LNI documents, training materials, and tools for Network Leaders.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><h3>ğŸ“š Core Documents</h3></div>
          <div class="card-body">
            <div class="resource-grid">
              <a class="resource-card" href="pioneer-toolkit.html" target="_blank">
                <div class="resource-icon">ğŸ§­</div>
                <h4>Pioneer Toolkit</h4>
                <p>Complete guide for starting and growing your LNI network</p>
              </a>
              <a class="resource-card" href="#" target="_blank">
                <div class="resource-icon">ğŸ“‹</div>
                <h4>Network Leader Standards</h4>
                <p>LNI's expectations and guidelines for all network leaders</p>
              </a>
              <a class="resource-card" href="#" target="_blank">
                <div class="resource-icon">ğŸ›ï¸</div>
                <h4>Gathering Structure Template</h4>
                <p>Recommended flow for your weekly or monthly gatherings</p>
              </a>
              <a class="resource-card" href="#" target="_blank">
                <div class="resource-icon">ğŸ¨</div>
                <h4>Brand & Comms Kit</h4>
                <p>LNI logos, colours, and communication guidelines</p>
              </a>
              <a class="resource-card" href="#" target="_blank">
                <div class="resource-icon">ğŸ“–</div>
                <h4>LNI Constitution</h4>
                <p>The governing document and values of the network</p>
              </a>
              <a class="resource-card" href="teachings.html" target="_blank">
                <div class="resource-icon">ğŸ¬</div>
                <h4>Teachings Archive</h4>
                <p>All LNI teachings for use in your network gatherings</p>
              </a>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><h3>ğŸ“ Quick Contact</h3></div>
          <div class="card-body">
            <div class="three-col">
              <div style="padding:16px;background:var(--mid);border-radius:var(--radius);text-align:center">
                <div style="font-size:24px;margin-bottom:8px">ğŸ’¬</div>
                <h4 style="font-size:12px;color:var(--gold-pale);margin-bottom:4px">WhatsApp HQ</h4>
                <p style="font-size:11px;color:var(--muted)">Direct line to leadership team</p>
              </div>
              <div style="padding:16px;background:var(--mid);border-radius:var(--radius);text-align:center">
                <div style="font-size:24px;margin-bottom:8px">ğŸ“§</div>
                <h4 style="font-size:12px;color:var(--gold-pale);margin-bottom:4px">leaders@lehemnetwork.org</h4>
                <p style="font-size:11px;color:var(--muted)">Email HQ leadership directly</p>
              </div>
              <div style="padding:16px;background:var(--mid);border-radius:var(--radius);text-align:center">
                <div style="font-size:24px;margin-bottom:8px">ğŸ—“ï¸</div>
                <h4 style="font-size:12px;color:var(--gold-pale);margin-bottom:4px">Book a Call</h4>
                <p style="font-size:11px;color:var(--muted)">Schedule 1-on-1 time with HQ</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ PROFILE â”€â”€ -->
      <div class="panel" id="panel-profile">
        <div class="section-header">
          <div>
            <h2>My Profile</h2>
            <p>Update your personal and network details. Kept on file with LNI HQ.</p>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <div class="form-section">
              <div class="form-section-title">Personal Details</div>
              <div class="form-grid">
                <div class="field"><label>First Name</label><input type="text" id="p-fname"></div>
                <div class="field"><label>Last Name</label><input type="text" id="p-lname"></div>
                <div class="field"><label>Email Address</label><input type="email" id="p-email" readonly style="opacity:0.6"></div>
                <div class="field"><label>Phone / WhatsApp</label><input type="tel" id="p-phone"></div>
              </div>
            </div>
            <div class="form-section">
              <div class="form-section-title">Network Details</div>
              <div class="form-grid">
                <div class="field"><label>Network Name</label><input type="text" id="p-network-name"></div>
                <div class="field"><label>City</label><input type="text" id="p-city"></div>
                <div class="field"><label>Country</label><input type="text" id="p-country"></div>
                <div class="field"><label>Network Started (Month / Year)</label><input type="text" id="p-started" placeholder="e.g. March 2024"></div>
              </div>
              <div class="form-grid single mt-8">
                <div class="field"><label>Brief Network Bio</label><textarea id="p-bio" rows="3" placeholder="A short description of your network, its vision, and its context..."></textarea></div>
              </div>
            </div>
            <div class="flex-between">
              <div>
                <button class="btn-danger" onclick="changePassword()">Change Password</button>
              </div>
              <button class="btn-gold" onclick="saveProfile()">Save Profile</button>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- REPORT DETAIL MODAL -->
<div class="modal-overlay" id="report-modal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal('report-modal')">âœ•</button>
    <h3 id="modal-report-title">Report Details</h3>
    <div id="modal-report-body"></div>
    <div id="modal-hq-feedback" style="margin-top:20px;display:none">
      <div class="gold-divider"></div>
      <div style="font-family:'Cinzel',serif;font-size:12px;color:var(--gold);margin-bottom:10px">HQ RESPONSE</div>
      <div id="modal-feedback-text" style="font-size:13px;color:var(--text);line-height:1.7;background:var(--warm);padding:14px;border-radius:var(--radius);border-left:3px solid var(--gold)"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FIREBASE + APP LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
import { getAuth, signInWithEmailAndPassword, signOut, sendPasswordResetEmail, onAuthStateChanged, setPersistence, browserLocalPersistence }
  from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
import { getFirestore, doc, getDoc, setDoc, addDoc, collection, query, where,
  orderBy, getDocs, onSnapshot, updateDoc, serverTimestamp, increment }
  from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

// â”€â”€ CONFIG â”€â”€ Replace with your actual Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDSTqQrkY5tiSPoNsE12VpFH-aiV-bD2sg",
  authDomain: "lni-global.firebaseapp.com",
  projectId: "lni-global",
  storageBucket: "lni-global.appspot.com",
  messagingSenderId: "1011021757015",
  appId: "1:1011021757015:web:e01c90d5c29925adf6c112"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// â”€â”€ STATE â”€â”€
let currentUser = null;
let leaderProfile = null;
let unsubMessages = null;
let unsubAnnouncements = null;

// â”€â”€ AUTH STATE â”€â”€
onAuthStateChanged(auth, async (user) => {
  if (user) {
    await setPersistence(auth, browserLocalPersistence);
    currentUser = user;
    await loadLeaderProfile();
    bootApp();
  } else {
    showAuthScreen();
  }
});

// â”€â”€ LOAD PROFILE â”€â”€
async function loadLeaderProfile() {
  const snap = await getDoc(doc(db, 'leaders', currentUser.uid));
  if (snap.exists()) {
    leaderProfile = snap.data();
  } else {
    // First login â€” create profile stub
    leaderProfile = {
      uid: currentUser.uid,
      email: currentUser.email,
      firstName: '', lastName: '',
      networkName: '', city: '', country: '',
      phone: '', bio: '', networkStarted: '',
      totalMembers: 0, totalGatherings: 0,
      totalTestimonies: 0, totalSalvations: 0,
      createdAt: serverTimestamp(),
      lastLogin: serverTimestamp(),
    };
    await setDoc(doc(db, 'leaders', currentUser.uid), leaderProfile);
  }
  // Update last login
  await updateDoc(doc(db, 'leaders', currentUser.uid), { lastLogin: serverTimestamp() });
}

// â”€â”€ BOOT APP â”€â”€
function bootApp() {
  document.getElementById('auth-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';

  const name = leaderProfile.firstName || leaderProfile.email;
  const initials = ((leaderProfile.firstName||'?')[0] + (leaderProfile.lastName||'?')[0]).toUpperCase();

  document.getElementById('sidebar-avatar').textContent = initials;
  document.getElementById('sidebar-name').textContent =
    leaderProfile.firstName ? `${leaderProfile.firstName} ${leaderProfile.lastName}` : leaderProfile.email;
  document.getElementById('sidebar-network').textContent = leaderProfile.networkName || 'Network not set';
  document.getElementById('sidebar-city').textContent =
    [leaderProfile.city, leaderProfile.country].filter(Boolean).join(', ') || 'Location not set';
  document.getElementById('dash-welcome').textContent = `Welcome, ${leaderProfile.firstName || 'Leader'}`;
  document.getElementById('dash-network-name').textContent =
    `${leaderProfile.networkName || 'Your Network'} Â· ${leaderProfile.city || ''}${leaderProfile.country ? ', ' + leaderProfile.country : ''}`;
  document.getElementById('r-network-display').value = leaderProfile.networkName || '';
  document.getElementById('topbar-subtitle').textContent =
    `${leaderProfile.networkName || 'Your Network'} Â· ${new Date().toLocaleDateString('en-GB', {weekday:'long', day:'numeric', month:'long'})}`;

  // Populate profile form
  document.getElementById('p-fname').value = leaderProfile.firstName || '';
  document.getElementById('p-lname').value = leaderProfile.lastName || '';
  document.getElementById('p-email').value = leaderProfile.email || '';
  document.getElementById('p-phone').value = leaderProfile.phone || '';
  document.getElementById('p-network-name').value = leaderProfile.networkName || '';
  document.getElementById('p-city').value = leaderProfile.city || '';
  document.getElementById('p-country').value = leaderProfile.country || '';
  document.getElementById('p-started').value = leaderProfile.networkStarted || '';
  document.getElementById('p-bio').value = leaderProfile.bio || '';

  loadDashboardStats();
  loadAnnouncements();
  loadMessages();
  loadGoals();
  loadReports();
  loadPrayerRequests();

  // Auto-set year to current
  const yr = new Date().getFullYear().toString();
  const yrSel = document.getElementById('r-year');
  for (let o of yrSel.options) { if (o.value === yr) { o.selected = true; break; } }
}

// â”€â”€ DASHBOARD STATS â”€â”€
async function loadDashboardStats() {
  const reportsQ = query(
    collection(db, 'leader_reports'),
    where('leaderUid', '==', currentUser.uid),
    orderBy('createdAt', 'desc')
  );
  const snap = await getDocs(reportsQ);
  const reports = snap.docs.map(d => ({ id: d.id, ...d.data() }));

  document.getElementById('stat-reports').textContent = reports.length;

  if (reports.length > 0) {
    const latest = reports[0];
    document.getElementById('stat-members').textContent = latest.members || 'â€“';
    document.getElementById('stat-gatherings').textContent = latest.gatherings || 'â€“';
    document.getElementById('stat-testimonies').textContent = latest.totalTestimonies || 'â€“';

    // Show last report card
    document.getElementById('last-report-card').style.display = 'block';
    document.getElementById('last-report-status').className =
      'report-status ' + (latest.status === 'reviewed' ? 'reviewed' : 'submitted');
    document.getElementById('last-report-status').textContent =
      latest.status === 'reviewed' ? 'âœ“ Reviewed by HQ' : 'Submitted';
    document.getElementById('last-report-body').innerHTML = `
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px">
        ${reportStat('Members', latest.members)}
        ${reportStat('New Members', latest.newMembers)}
        ${reportStat('Gatherings', latest.gatherings)}
        ${reportStat('Salvations', latest.salvations)}
        ${reportStat('Miracles', latest.miracles)}
        ${reportStat('Disciples', latest.disciples)}
      </div>
      ${latest.hqFeedback ? `<div style="margin-top:14px;padding:12px;background:rgba(201,146,42,0.08);border-radius:var(--radius);border-left:3px solid var(--gold)"><p style="font-size:11px;color:var(--gold);margin-bottom:4px">HQ FEEDBACK</p><p style="font-size:13px;color:var(--text)">${latest.hqFeedback}</p></div>` : ''}
    `;
  }
}

function reportStat(label, value) {
  return `<div style="background:var(--warm);padding:12px;border-radius:var(--radius);text-align:center">
    <div style="font-size:20px;color:var(--gold-pale);font-weight:700">${value || 'â€“'}</div>
    <div style="font-size:10px;color:var(--muted);text-transform:uppercase;margin-top:3px">${label}</div>
  </div>`;
}

// â”€â”€ ANNOUNCEMENTS â”€â”€
function loadAnnouncements() {
  const q = query(collection(db, 'announcements'), orderBy('createdAt', 'desc'));
  unsubAnnouncements = onSnapshot(q, (snap) => {
    const items = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderAnnouncements(items, 'announcements-list');
    renderAnnouncements(items.slice(0, 2), 'dash-announcements');
  });
}

function renderAnnouncements(items, targetId) {
  const el = document.getElementById(targetId);
  if (!items.length) {
    el.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“­</div><p>No announcements yet</p></div>';
    return;
  }
  el.innerHTML = items.map(a => `
    <div class="announcement-item">
      <div class="ann-meta">
        <span class="ann-tag ${a.tag || 'update'}">${a.tag || 'Update'}</span>
        <span class="ann-date">${formatDate(a.createdAt)}</span>
      </div>
      <h4>${a.title}</h4>
      <p>${a.body}</p>
    </div>
  `).join('');
}

// â”€â”€ MESSAGES â”€â”€
function loadMessages() {
  const q = query(
    collection(db, 'messages'),
    where('leaderUid', '==', currentUser.uid),
    orderBy('createdAt', 'asc')
  );
  unsubMessages = onSnapshot(q, (snap) => {
    const msgs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderMessages(msgs);
    const unread = msgs.filter(m => m.from === 'hq' && !m.readByLeader).length;
    const badge = document.getElementById('msg-badge');
    if (unread > 0) {
      badge.style.display = 'inline-block';
      badge.textContent = unread;
    } else {
      badge.style.display = 'none';
    }
  });
}

function renderMessages(msgs) {
  const thread = document.getElementById('message-thread');
  const preview = document.getElementById('dash-messages-preview');
  if (!msgs.length) {
    thread.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ’¬</div><p>No messages yet. Start a conversation with HQ.</p></div>';
    preview.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ’¬</div><p>No messages yet</p></div>';
    return;
  }
  thread.innerHTML = msgs.map(m => `
    <div class="message-bubble ${m.from === 'hq' ? 'from-hq' : 'from-me'}">
      <div class="message-sender">${m.from === 'hq' ? 'ğŸ› LNI HQ' : 'ğŸ‘¤ You'}</div>
      <div class="message-text">${m.text}</div>
      <div class="message-time">${formatDate(m.createdAt)}</div>
    </div>
  `).join('');
  thread.scrollTop = thread.scrollHeight;

  const last = msgs[msgs.length - 1];
  preview.innerHTML = `<div style="padding:10px;background:var(--warm);border-radius:var(--radius)">
    <p style="font-size:10px;color:var(--muted);margin-bottom:4px">${last.from === 'hq' ? 'From HQ' : 'You'} Â· ${formatDate(last.createdAt)}</p>
    <p style="font-size:13px;color:var(--text)">${last.text.substring(0, 100)}${last.text.length > 100 ? '...' : ''}</p>
  </div>`;
}

window.sendMessage = async function() {
  const input = document.getElementById('msg-input');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  try {
    await addDoc(collection(db, 'messages'), {
      leaderUid: currentUser.uid,
      leaderName: `${leaderProfile.firstName} ${leaderProfile.lastName}`,
      networkName: leaderProfile.networkName,
      from: 'leader',
      text,
      createdAt: serverTimestamp(),
      readByHQ: false,
    });
  } catch(e) { toast('Failed to send message', 'error'); }
};

window.handleMsgKey = function(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
};

// â”€â”€ REPORTS â”€â”€
async function loadReports() {
  const q = query(
    collection(db, 'leader_reports'),
    where('leaderUid', '==', currentUser.uid),
    orderBy('createdAt', 'desc')
  );
  const snap = await getDocs(q);
  const reports = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  const list = document.getElementById('reports-list');

  if (!reports.length) {
    list.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><p>No reports submitted yet. Submit your first monthly report to get started.</p></div>';
    return;
  }

  list.innerHTML = reports.map(r => `
    <div class="report-item" onclick="openReportModal('${r.id}')">
      <div class="report-item-left">
        <div class="report-month-badge">
          <div class="month">${(r.month||'').substring(0,3)}</div>
          <div class="year">${r.year||''}</div>
        </div>
        <div class="report-meta">
          <h4>${r.month} ${r.year} â€” ${leaderProfile.networkName}</h4>
          <p>${r.members || 0} members Â· ${r.gatherings || 0} gatherings Â· ${r.salvations || 0} salvations</p>
        </div>
      </div>
      <span class="report-status ${r.status === 'reviewed' ? 'reviewed' : r.status === 'needs-action' ? 'needs-action' : 'submitted'}">
        ${r.status === 'reviewed' ? 'âœ“ Reviewed' : r.status === 'needs-action' ? 'âš  Action Needed' : 'Submitted'}
      </span>
    </div>
  `).join('');
}

window.openReportModal = async function(reportId) {
  const snap = await getDoc(doc(db, 'leader_reports', reportId));
  if (!snap.exists()) return;
  const r = snap.data();
  document.getElementById('modal-report-title').textContent = `${r.month} ${r.year} Report`;
  document.getElementById('modal-report-body').innerHTML = `
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">
      ${reportStat('Members', r.members)}${reportStat('New', r.newMembers)}${reportStat('Gatherings', r.gatherings)}
      ${reportStat('Salvations', r.salvations)}${reportStat('Miracles', r.miracles)}${reportStat('Disciples', r.disciples)}
    </div>
    ${r.testimonies ? `<div style="margin-bottom:12px"><p style="font-size:11px;color:var(--gold);margin-bottom:4px">TESTIMONIES & HIGHLIGHTS</p><p style="font-size:13px;color:var(--text);line-height:1.7">${r.testimonies}</p></div>` : ''}
    ${r.challenges ? `<div style="margin-bottom:12px"><p style="font-size:11px;color:var(--gold);margin-bottom:4px">CHALLENGES & PRAYER POINTS</p><p style="font-size:13px;color:var(--text);line-height:1.7">${r.challenges}</p></div>` : ''}
    ${r.support ? `<div style="margin-bottom:12px"><p style="font-size:11px;color:var(--gold);margin-bottom:4px">SUPPORT REQUESTED</p><p style="font-size:13px;color:var(--text);line-height:1.7">${r.support}</p></div>` : ''}
    ${r.vision ? `<div><p style="font-size:11px;color:var(--gold);margin-bottom:4px">VISION FOR NEXT MONTH</p><p style="font-size:13px;color:var(--text);line-height:1.7">${r.vision}</p></div>` : ''}
  `;
  const feedbackEl = document.getElementById('modal-hq-feedback');
  if (r.hqFeedback) {
    feedbackEl.style.display = 'block';
    document.getElementById('modal-feedback-text').textContent = r.hqFeedback;
  } else {
    feedbackEl.style.display = 'none';
  }
  document.getElementById('report-modal').classList.add('open');
};

window.closeModal = function(id) {
  document.getElementById(id).classList.remove('open');
};

// â”€â”€ SUBMIT REPORT â”€â”€
window.submitReport = async function() {
  const month = document.getElementById('r-month').value;
  const year = document.getElementById('r-year').value;
  if (!month) { toast('Please select a month', 'error'); return; }

  const btn = document.getElementById('submit-report-btn');
  btn.disabled = true; btn.textContent = 'Submitting...';

  try {
    const data = {
      leaderUid: currentUser.uid,
      leaderName: `${leaderProfile.firstName} ${leaderProfile.lastName}`,
      networkName: leaderProfile.networkName,
      city: leaderProfile.city, country: leaderProfile.country,
      email: leaderProfile.email,
      month, year,
      members: +document.getElementById('r-members').value || 0,
      newMembers: +document.getElementById('r-new-members').value || 0,
      gatherings: +document.getElementById('r-gatherings').value || 0,
      avgAttendance: +document.getElementById('r-avg-attendance').value || 0,
      salvations: +document.getElementById('r-salvations').value || 0,
      miracles: +document.getElementById('r-miracles').value || 0,
      outreach: +document.getElementById('r-outreach').value || 0,
      disciples: +document.getElementById('r-disciples').value || 0,
      testimonies: document.getElementById('r-testimonies').value,
      challenges: document.getElementById('r-challenges').value,
      support: document.getElementById('r-support').value,
      vision: document.getElementById('r-vision').value,
      status: 'submitted',
      createdAt: serverTimestamp(),
      hqFeedback: '',
    };
    await addDoc(collection(db, 'leader_reports'), data);
    toast('Report submitted to HQ successfully!', 'success');
    loadReports(); loadDashboardStats();
    showPanel('my-reports');
  } catch(e) {
    toast('Failed to submit report. Please try again.', 'error');
  } finally {
    btn.disabled = false; btn.textContent = 'Submit Report to HQ â†’';
  }
};

window.saveDraft = async function() {
  toast('Draft saved locally', 'info');
};

// â”€â”€ GOALS â”€â”€
async function loadGoals() {
  const snap = await getDoc(doc(db, 'leader_goals', currentUser.uid));
  if (snap.exists()) {
    const g = snap.data();
    document.getElementById('g-members').value = g.members || '';
    document.getElementById('g-gatherings').value = g.gatherings || '';
    document.getElementById('g-salvations').value = g.salvations || '';
    document.getElementById('g-disciples').value = g.disciples || '';
    document.getElementById('g-vision').value = g.vision || '';
    renderGoalProgress(g);
    renderDashGoals(g);
  }
}

function renderGoalProgress(g) {
  const el = document.getElementById('goals-progress');
  const current = {
    members: leaderProfile.totalMembers || 0,
    gatherings: 0,
    salvations: leaderProfile.totalSalvations || 0,
    disciples: 0,
  };
  el.innerHTML = `
    ${goalBar('Members', current.members, g.members)}
    ${goalBar('Monthly Gatherings', current.gatherings, g.gatherings)}
    ${goalBar('Salvations', current.salvations, g.salvations)}
    ${goalBar('Disciples in Training', current.disciples, g.disciples)}
    ${g.vision ? `<div style="margin-top:16px;padding:12px;background:var(--warm);border-radius:var(--radius);border-left:3px solid var(--gold)"><p style="font-size:10px;color:var(--gold);margin-bottom:4px">ONE-YEAR VISION</p><p style="font-size:13px;color:var(--text);line-height:1.6">${g.vision}</p></div>` : ''}
  `;
}

function renderDashGoals(g) {
  document.getElementById('dash-goals').innerHTML = `
    ${goalBar('Members Goal', 0, g.members)}
    ${goalBar('Gatherings Goal', 0, g.gatherings)}
    ${goalBar('Salvations Goal', 0, g.salvations)}
  `;
}

function goalBar(label, current, target) {
  if (!target) return '';
  const pct = Math.min(100, Math.round((current / target) * 100));
  return `<div class="goal-item">
    <div class="goal-header">
      <span class="goal-label">${label}</span>
      <span class="goal-numbers">${current} / ${target}</span>
    </div>
    <div class="progress-bar-bg">
      <div class="progress-bar-fill" style="width:${pct}%"></div>
    </div>
  </div>`;
}

window.saveGoals = async function() {
  const data = {
    leaderUid: currentUser.uid,
    members: +document.getElementById('g-members').value || 0,
    gatherings: +document.getElementById('g-gatherings').value || 0,
    salvations: +document.getElementById('g-salvations').value || 0,
    disciples: +document.getElementById('g-disciples').value || 0,
    vision: document.getElementById('g-vision').value,
    updatedAt: serverTimestamp(),
  };
  try {
    await setDoc(doc(db, 'leader_goals', currentUser.uid), data);
    renderGoalProgress(data); renderDashGoals(data);
    toast('Goals saved successfully!', 'success');
  } catch(e) { toast('Failed to save goals', 'error'); }
};

// â”€â”€ PRAYER REQUESTS â”€â”€
async function loadPrayerRequests() {
  const q = query(
    collection(db, 'prayer_requests'),
    where('visibility', '!=', 'hq'),
    orderBy('visibility'),
    orderBy('createdAt', 'desc')
  );
  const snap = await getDocs(q);
  const prayers = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  const mine = prayers.filter(p => p.leaderUid === currentUser.uid);
  renderPrayers(prayers, 'prayer-list');
  renderPrayers(mine, 'prayer-mine-list');
}

function renderPrayers(prayers, targetId) {
  const el = document.getElementById(targetId);
  if (!prayers.length) {
    el.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ™</div><p>No prayer requests yet</p></div>';
    return;
  }
  el.innerHTML = prayers.map(p => `
    <div class="prayer-item">
      <div class="prayer-meta">
        <span class="prayer-network">${p.networkName || 'A Leader'}</span>
        <span class="ann-tag reminder">${p.category}</span>
        <span class="prayer-date">${formatDate(p.createdAt)}</span>
      </div>
      <p class="prayer-text">${p.text}</p>
      <div style="margin-top:8px">
        <button onclick="agreeInPrayer('${p.id}', this)" style="font-size:11px;padding:4px 12px;background:rgba(201,146,42,0.1);border:1px solid rgba(201,146,42,0.2);border-radius:20px;color:var(--gold);cursor:pointer">
          ğŸ™ Agree in Prayer ${p.agreeCount > 0 ? '(' + p.agreeCount + ')' : ''}
        </button>
      </div>
    </div>
  `).join('');
}

window.agreeInPrayer = async function(id, btn) {
  await updateDoc(doc(db, 'prayer_requests', id), { agreeCount: increment(1) });
  btn.disabled = true; btn.style.opacity = '0.5';
};

window.submitPrayer = async function() {
  const text = document.getElementById('p-text').value.trim();
  if (!text) { toast('Please write your prayer request', 'error'); return; }
  try {
    await addDoc(collection(db, 'prayer_requests'), {
      leaderUid: currentUser.uid,
      leaderName: `${leaderProfile.firstName} ${leaderProfile.lastName}`,
      networkName: leaderProfile.networkName,
      category: document.getElementById('p-category').value,
      text,
      visibility: document.getElementById('p-visibility').value,
      agreeCount: 0,
      createdAt: serverTimestamp(),
    });
    document.getElementById('p-text').value = '';
    toast('Prayer request submitted', 'success');
    loadPrayerRequests();
    switchPrayerTab('all', document.querySelector('.tab-btn'));
  } catch(e) { toast('Failed to submit prayer request', 'error'); }
};

window.switchPrayerTab = function(tab, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('prayer-tab-all').style.display = tab === 'all' ? 'block' : 'none';
  document.getElementById('prayer-tab-mine').style.display = tab === 'mine' ? 'block' : 'none';
  document.getElementById('prayer-tab-submit').style.display = tab === 'submit' ? 'block' : 'none';
};

// â”€â”€ PROFILE â”€â”€
window.saveProfile = async function() {
  const data = {
    firstName: document.getElementById('p-fname').value.trim(),
    lastName: document.getElementById('p-lname').value.trim(),
    phone: document.getElementById('p-phone').value.trim(),
    networkName: document.getElementById('p-network-name').value.trim(),
    city: document.getElementById('p-city').value.trim(),
    country: document.getElementById('p-country').value.trim(),
    networkStarted: document.getElementById('p-started').value.trim(),
    bio: document.getElementById('p-bio').value.trim(),
    updatedAt: serverTimestamp(),
  };
  try {
    await updateDoc(doc(db, 'leaders', currentUser.uid), data);
    Object.assign(leaderProfile, data);
    document.getElementById('sidebar-name').textContent = `${data.firstName} ${data.lastName}`;
    document.getElementById('sidebar-network').textContent = data.networkName;
    document.getElementById('sidebar-city').textContent = [data.city, data.country].filter(Boolean).join(', ');
    document.getElementById('sidebar-avatar').textContent =
      ((data.firstName[0]||'?') + (data.lastName[0]||'?')).toUpperCase();
    toast('Profile saved!', 'success');
  } catch(e) { toast('Failed to save profile', 'error'); }
};

window.changePassword = function() {
  sendPasswordResetEmail(auth, currentUser.email)
    .then(() => toast('Password reset email sent to ' + currentUser.email, 'success'))
    .catch(() => toast('Failed to send reset email', 'error'));
};

// â”€â”€ AUTH â”€â”€
window.doLogin = async function() {
  const email = document.getElementById('login-email').value.trim();
  const pw = document.getElementById('login-password').value;
  const btn = document.getElementById('login-btn');
  const err = document.getElementById('auth-error');
  err.style.display = 'none';
  btn.disabled = true; btn.textContent = 'Signing in...';
  try {
    await signInWithEmailAndPassword(auth, email, pw);
  } catch(e) {
    err.style.display = 'block';
    err.textContent = e.code === 'auth/user-not-found' ? 'No account found with this email.' :
      e.code === 'auth/wrong-password' ? 'Incorrect password. Please try again.' :
      e.code === 'auth/too-many-requests' ? 'Too many attempts. Please wait and try again.' :
      'Sign in failed. Please check your details.';
    btn.disabled = false; btn.textContent = 'Sign In to Portal';
  }
};

window.doPasswordReset = async function() {
  const email = document.getElementById('login-email').value.trim();
  if (!email) { document.getElementById('auth-error').style.display='block'; document.getElementById('auth-error').textContent='Please enter your email address first.'; return; }
  try {
    await sendPasswordResetEmail(auth, email);
    const err = document.getElementById('auth-error');
    err.style.display = 'block';
    err.style.background = 'rgba(74,154,106,0.1)';
    err.style.borderColor = 'rgba(74,154,106,0.3)';
    err.style.color = '#6ACA8A';
    err.textContent = 'Password reset email sent. Check your inbox.';
  } catch(e) { /* silent */ }
};

window.doLogout = async function() {
  if (unsubMessages) unsubMessages();
  if (unsubAnnouncements) unsubAnnouncements();
  await signOut(auth);
  document.getElementById('app').style.display = 'none';
  document.getElementById('auth-screen').style.display = 'flex';
};

function showAuthScreen() {
  document.getElementById('auth-screen').style.display = 'flex';
  document.getElementById('app').style.display = 'none';
}

// â”€â”€ FILE UPLOAD LABEL â”€â”€
document.getElementById('r-file').addEventListener('change', function() {
  const names = Array.from(this.files).map(f => f.name).join(', ');
  document.getElementById('r-file-label').textContent = names || 'No files selected';
});

// â”€â”€ UI HELPERS â”€â”€
window.showPanel = function(id) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const titles = {
    dashboard: ['Dashboard', 'Your network at a glance'],
    'submit-report': ['Submit Monthly Report', 'Complete and submit your monthly network report to HQ'],
    'my-reports': ['My Report History', 'All reports submitted to LNI HQ'],
    'my-goals': ['Network Goals', 'Track your network targets and progress'],
    messages: ['Messages with HQ', 'Direct communication with Lehem Network International HQ'],
    announcements: ['Announcements', 'Official communications from LNI HQ'],
    'prayer-wall': ['Network Prayer Wall', 'Shared prayer with fellow network leaders'],
    resources: ['Toolkit & Resources', 'Documents, guides, and contact links'],
    profile: ['My Profile', 'Your personal and network details'],
  };
  if (titles[id]) {
    document.getElementById('topbar-title').textContent = titles[id][0];
    document.getElementById('topbar-subtitle').textContent = titles[id][1];
  }
};

function formatDate(ts) {
  if (!ts) return '';
  const d = ts.toDate ? ts.toDate() : new Date(ts);
  return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
}

function toast(msg, type = 'info') {
  const t = document.createElement('div');
  t.className = `toast-item ${type}`;
  t.innerHTML = `${type==='success'?'âœ“':type==='error'?'âœ•':'â„¹'} ${msg}`;
  document.getElementById('toast').appendChild(t);
  setTimeout(() => t.remove(), 4000);
}

// Enter key for login
document.getElementById('login-password').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});
</script>
</body>
</html>
